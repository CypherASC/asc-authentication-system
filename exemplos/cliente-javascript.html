<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cliente ASC - Exemplo</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        input { width: 100%; padding: 10px; margin-top: 5px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; cursor: pointer; }
        .resultado { margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üîê Cliente ASC - Exemplo de Integra√ß√£o</h1>

    <!-- Formul√°rio de Login -->
    <div id="loginForm">
        <h2>Login</h2>
        <div class="form-group">
            <label>Email:</label>
            <input type="email" id="email" value="teste@exemplo.com">
        </div>
        <div class="form-group">
            <label>Senha:</label>
            <input type="password" id="senha" value="MinhaSenh@123">
        </div>
        <button onclick="fazerLogin()">Login</button>
    </div>

    <!-- √Årea autenticada -->
    <div id="areaAutenticada" style="display: none;">
        <h2>√Årea Autenticada</h2>
        <p>Bem-vindo, <span id="nomeUsuario"></span>!</p>
        <button onclick="obterPerfil()">Obter Perfil</button>
        <button onclick="obterSessoes()">Listar Sess√µes</button>
        <button onclick="logout()">Logout</button>
    </div>

    <div id="resultado" class="resultado"></div>

    <script>
        // Cliente ASC JavaScript
        class ClienteASC {
            constructor(baseURL = '') {
                this.baseURL = baseURL;
                this.token = localStorage.getItem('token');
            }

            async requisicao(endpoint, opcoes = {}) {
                const url = this.baseURL + endpoint;
                const config = {
                    headers: {
                        'Content-Type': 'application/json',
                        ...opcoes.headers
                    },
                    ...opcoes
                };

                if (this.token) {
                    config.headers.Authorization = `Bearer ${this.token}`;
                }

                const resposta = await fetch(url, config);
                return resposta.json();
            }

            async login(email, senha) {
                const dados = await this.requisicao('/api/autenticacao/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, senha })
                });

                if (dados.sucesso) {
                    this.token = dados.dados.token;
                    localStorage.setItem('token', this.token);
                }

                return dados;
            }

            async obterPerfil() {
                return this.requisicao('/api/usuario/perfil');
            }

            async obterSessoes() {
                return this.requisicao('/api/usuario/sessoes');
            }

            async logout() {
                const resultado = await this.requisicao('/api/autenticacao/logout', {
                    method: 'POST'
                });
                
                this.token = null;
                localStorage.removeItem('token');
                return resultado;
            }
        }

        // Inst√¢ncia do cliente
        const asc = new ClienteASC();

        // Fun√ß√µes da interface
        async function fazerLogin() {
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;

            try {
                const resultado = await asc.login(email, senha);
                mostrarResultado(resultado);

                if (resultado.sucesso) {
                    document.getElementById('loginForm').style.display = 'none';
                    document.getElementById('areaAutenticada').style.display = 'block';
                    document.getElementById('nomeUsuario').textContent = resultado.dados.usuario.nome;
                }
            } catch (error) {
                mostrarResultado({ sucesso: false, mensagem: error.message });
            }
        }

        async function obterPerfil() {
            try {
                const resultado = await asc.obterPerfil();
                mostrarResultado(resultado);
            } catch (error) {
                mostrarResultado({ sucesso: false, mensagem: error.message });
            }
        }

        async function obterSessoes() {
            try {
                const resultado = await asc.obterSessoes();
                mostrarResultado(resultado);
            } catch (error) {
                mostrarResultado({ sucesso: false, mensagem: error.message });
            }
        }

        async function logout() {
            try {
                const resultado = await asc.logout();
                mostrarResultado(resultado);
                
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('areaAutenticada').style.display = 'none';
            } catch (error) {
                mostrarResultado({ sucesso: false, mensagem: error.message });
            }
        }

        function mostrarResultado(dados) {
            const elemento = document.getElementById('resultado');
            elemento.innerHTML = `<pre>${JSON.stringify(dados, null, 2)}</pre>`;
        }

        // Verificar se j√° est√° logado
        if (asc.token) {
            asc.obterPerfil().then(resultado => {
                if (resultado.sucesso) {
                    document.getElementById('loginForm').style.display = 'none';
                    document.getElementById('areaAutenticada').style.display = 'block';
                    document.getElementById('nomeUsuario').textContent = resultado.dados.nome;
                }
            });
        }
    </script>
</body>
</html>